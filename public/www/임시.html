<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <script
      type="text/javascript"
      src="https://cdn.iamport.kr/js/iamport.payment-1.1.5.js"
    ></script>
    <script src="https://cdn.iamport.kr/v1/iamport.js"></script>

    <link
      rel="stylesheet"
      href="/src/main/resources/static/resources/css/common/pay_modal.css"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <input
      class="sessionuserID"
      type="hidden"
      value="${sessionScope.user_id}"
    />
    <input class="amountValue" type="hidden" value="6000" />
    <!-- 고정된 결제 금액 -->
    <div class="popup">
      <!-- 팝업처럼 하기 위한 배경 -->
      <div class="pwrap">
        <!-- 실제 팝업창 -->
        <a class="closebtn">X</a>
        <!-- 비밀번호 변경창 닫기 버튼 -->
        <div></div>
        <p><a href="#" onclick="kakaopay()">카카오결제</a></p>
        <p><a href="#" onclick="tosspay()">토스결제</a></p>
      </div>
    </div>
    <script>
      function kakaopay() {
        var IMP = window.IMP;
        IMP.init("imp10657444");
        IMP.request_pay(
          {
            pg: "kakaopay.TC0ONETIME",
            pay_method: "card",
            merchant_uid: "merchant_" + new Date().getTime(), //주문번호
            name: "GOOTTFLEX", //상품명
            amount: $(".amountValue").val(), //가격
            buyer_email: $(".sessionuserID").val(), //구매자 이메일
            buyer_name: "buyer_name", //구매자 이름
            buyer_tel: "hp", //전화번호
            buyer_addr: "addr", //주소
            buyer_postcode: "123-456", //우편번호
          },
          function (data) {
            if (data.success) {
              var msg = "결제 완료";
              msg += "고유ID : " + data.imp_uid; //아임포트 uid는 실제 결제 시 결제 고유번호를 서버와 비교해서 결제처리하는데 필요없긴함.
              msg += "// 상점 거래ID : " + data.merchant_uid;
              msg += "// 결제 금액 : " + data.paid_amount;
              msg += "// 카드 승인번호 : " + data.apply_num;

              $.ajax({
                type: "post",
                url: "/paySuccess",
                data: { ID: data.buyer_email, amount: data.paid_amount },
              });
            } else {
              var msg = "결제 실패";
              msg += "에러 내용" + rsp.error_msg;
            }
            alert(msg);
            document.location.href = "/paymentcompleted";
          },
        );
      }

      /* 결제 모달 창 - 02.14 */
      const closebtn = document.querySelector(".closebtn");
      const popup = document.querySelector(".popup");
      const amountV = document.querySelector(".amountValue");

      function modal() {
        //결제창 on-off
        console.log("얍얍");
        popup.style.display = "block";
      }
      closebtn.addEventListener("click", function () {
        console.log("얍얍");

        popup.style.display = "none";
      });
    </script>
  </body>
</html>
